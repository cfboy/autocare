<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>
        <%= lingua.membership.createSusbscriptions%>
    </title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="../../vendors/feather/feather.css">
    <link rel="stylesheet" href="../../vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../../vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="../../vendors/typicons/typicons.css">
    <link rel="stylesheet" href="../../vendors/simple-line-icons/css/simple-line-icons.css">
    <link rel="stylesheet" href="../../vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="../../css/register.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
        integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../../vendors/select2/select2.min.css">
    <link rel="stylesheet" href="../../vendors/select2-bootstrap-theme/select2-bootstrap.min.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="../../js/select.dataTables.min.css">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="../../css/vertical-layout-light/style.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="../../images/favicon.png" />
</head>

<body>
    <div class="container-scroller">
        <div class="container-fluid page-body-wrapper full-page-wrapper">
            <div class="content-wrapper d-flex align-items-center auth px-0">
                <div class="row w-100 mx-0">
                    <div class="col-lg-8 mx-auto">
                        <div class="auth-form-light text-left py-5 px-4 px-sm-5">
                            <% if(user) { %>

                            <a class="btn btn-outline-primary btn-icon-text float-end" id="close-registration"
                                href="/account">
                                <%= lingua.home%> <i class="fa-solid fa-home m-1 mb-0 mt-0"></i>
                            </a>
                            <% } else { %>
                            <a class="btn btn-outline-primary btn-icon-text float-end" id="close-registration"
                                href="/ogin">
                                <%= lingua.login%> <i class="fa-solid fa-arrow-right-to-bracket m-1 mb-0 mt-0"></i>
                            </a>
                            <% } %>

                            <div class="brand-logo text-center">
                                <img src="/images/charlieBoy/CB-5.jpg" alt="logo" style="width: 25% !important;">
                            </div>

                            <h4>
                                <%= lingua.membership.createSusbscriptions%>
                            </h4>
                            <!-- <h6 class="fw-light">Sign in to continue.</h6> -->
                            <form id="form-register" class="pt-3" action="/register" method="post"
                                onsubmit="disableSubmitBtn()">
                                <div class="row">

                                </div>
                                <div class="row">
                                    <div class="col-sm-12 col-md-12 col-lg-12 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="card-title">
                                                    <%= lingua.membership.createSubscriptions%>
                                                </div>
                                                <form id="form-subscriptions" class="pt-3" method="post">
                                                    <div class="row">
                                                        <h5><i class="fa-solid fa-1 list-number"></i>
                                                            <%= lingua.user.email%>
                                                        </h5>
                                                        <hr>
                                                        <div class="col-lg-12">
                                                            <input id="userID" name="userID" value="<%= user?.id%>"
                                                                hidden />
                                                            <div class="form-group">
                                                                <label class="required"
                                                                    for="email"><%= lingua.user.email%></label>
                                                                <input type="email" id="email" name="email"
                                                                    onfocusout="validateEmail()"
                                                                    class="form-control form-control-lg"
                                                                    placeholder="example@gmail.com" required />

                                                                <div id="emailValidationResult"></div>

                                                            </div>
                                                        </div>


                                                        <h5><i class="fa-solid fa-2 list-number"></i>
                                                            <%= lingua.car.select%>
                                                        </h5>
                                                        <hr>

                                                        <%- include('../cars/formFields.ejs', {allMakes, car: null, userCars : []}); %>

                                                        <h5><i class="fa-solid fa-3 list-number"></i>
                                                            <%= lingua.membership.selectMembership%>
                                                        </h5>
                                                        <hr>
                                                        <div class="col-lg-12">
                                                            <div class="form-group">
                                                                <label for="product"
                                                                    class="required"><%= lingua.membership.name%></label>

                                                                <select id="product" name="product" required autofocus
                                                                    class="form-control mb-3 form-control-lg js-example-basic-single w-100">
                                                                    <option value=""><%= lingua.selectOne%></option>
                                                                    <% for(const price of prices) { %>
                                                                    <option value="<%= price.id%>"
                                                                        name="<%= price.product.name%>"
                                                                        price="<%= price.unit_amount%>">
                                                                        (<%= price.unit_amount%>)
                                                                        <%= price.product.name%>
                                                                    </option>
                                                                    <% } %>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-6 mt-4" id="formValidationResult"></div>

                                                        <div class="col-6 mt-3">
                                                            <button id="addSub" type="submit"
                                                                class="btn btn-block btn-primary btn-lg font-weight-medium auth-form-btn float-end">
                                                                <%= lingua.car.add%></button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="mt-3">
                                        <button id="submit-btn"
                                            class="btn btn-block btn-primary btn-lg font-weight-medium auth-form-btn float-end"
                                            type="submit"><%= lingua.membership.createSubscriptions%></button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- content-wrapper ends -->
        </div>
        <%- include('../partials/footer.ejs'); %>

        <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="../../vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="../../vendors/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="../../js/off-canvas.js"></script>
    <script src="../../js/hoverable-collapse.js"></script>
    <script src="../../js/template.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page-->
    <!-- <script src="../../js/register.js"></script> -->
    <script src="./js/jquery.cookie.js" type="text/javascript"></script>
    <script src="../../vendors/select2/select2.min.js"></script>
    <script src="../../js/select2.js"></script>
    <script src="../js/helper-functions.js"></script>

    <!-- End custom js for this page-->
    <script>

        function disableSubmitBtn() {
            $('#submit-btn').prop('disabled', true);
        };

        function validateEmail() {
            showResult('#emailValidationResult', ``);

            var email = document.getElementById("email");
            // x.value = x.value.toUpperCase();

            const validateRegexEmail = email.value.match(
                /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
            );

            if (validateRegexEmail) {
                $.ajax({
                    url: "/validateEmail",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({
                        email: email.value
                    }),
                }).done(function (result) {
                    if (result.invalidEmail) {
                        email.setCustomValidity(result.invalidMsj);
                        email.reportValidity();
                        // let reportMessage = `<p class="error">` + result.invalidMsj + `</p>`;
                        let reportMessage = `<p class="alert alert-fill-danger d-inline-flex mt-2 p-1 success">${result.invalidMsj}</p>`;

                        showResult('#emailValidationResult', reportMessage);

                    } else {
                        showResult('#emailValidationResult',
                            `<p class="alert alert-fill-success d-inline-flex mt-2 p-1 success"><%= lingua.validEmail%></p>`);
                    }
                });
            } else {
                email.reportValidity();
                showResult('#emailValidationResult',
                    `<p class="alert alert-fill-danger d-inline-flex mt-2 p-1 success">Invalid Email</p>`);
            }
        }
    </script>
</body>


</html>